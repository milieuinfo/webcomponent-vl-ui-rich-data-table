<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <script src="../../../@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../web-component-tester/browser.js"></script>

  <script type="module" src="../../src/vl-rich-data-table.js"></script>
</head>

<body>
  <test-fixture id="vl-rich-data-field-fixture">
    <template>
      <vl-rich-data-field data-vl-selector="foo" data-vl-label="Foo"></vl-rich-data-field>
    </template>
  </test-fixture>

  <test-fixture id="vl-rich-data-field-fixture-nested-property">
    <template>
      <vl-rich-data-field data-vl-selector="foo.bar" data-vl-label="Foo"></vl-rich-data-field>
    </template>
  </test-fixture>

  <test-fixture id="vl-rich-data-field-fixture-nested-property-array">
    <template>
      <vl-rich-data-field data-vl-selector="foo.0.bar" data-vl-label="Foo"></vl-rich-data-field>
    </template>
  </test-fixture>

  <test-fixture id="vl-rich-data-field-content-template-fixture">
    <template>
      <vl-rich-data-field data-vl-label="Foo">
        <template slot="content">
          <span>foo</span>
        </template>
      </vl-rich-data-field>
    </template>
  </test-fixture>

  <test-fixture id="vl-rich-data-field-dynamic-content-template-fixture">
    <template>
      <vl-rich-data-field data-vl-label="Foo">
        <template slot="content">
          <span>${item.foo.bar}</span>
        </template>
      </vl-rich-data-field>
    </template>
  </test-fixture>

  <test-fixture id="vl-rich-data-field-label-template-fixture">
    <template>
      <vl-rich-data-field data-vl-selector="foo">
        <template slot="label">
          <span>Foo</span>
        </template>
      </vl-rich-data-field>
    </template>
  </test-fixture>

  <script>
    suite('<vl-rich-data-field>', () => {
      const should = chai.should();

      test('Men kan de template van de waarde van een field opvragen voor een bepaalde rij data', () => {
        const dataRow = {
          foo: 'bar'
        };
        const field = fixture('vl-rich-data-field-fixture');
        field.valueTemplate(dataRow).should.equal('bar');
        should.not.exist(field.valueTemplate({}));
      });

      test('Men kan de template van de waarde van een field met een geneste object structuur opvragen voor een bepaalde rij data', () => {
        const dataRow = {
          foo: {
            bar: 'foobar'
          }
        };
        const field = fixture('vl-rich-data-field-fixture-nested-property');
        field.valueTemplate(dataRow).should.equal('foobar');
        should.not.exist(field.valueTemplate({}));
      });

      test('Men kan de template van de waarde van een field met een geneste object structuur met een array index opvragen voor een bepaalde rij data', () => {
        const dataRow = {
          foo: [{
            bar: 'foobar'
          }]
        };
        const field = fixture('vl-rich-data-field-fixture-nested-property-array');
        field.valueTemplate(dataRow).should.equal('foobar');
        should.not.exist(field.valueTemplate({}));
      });

      test('Indien er geen selector attribuut aanwezig is, zal de template content slot gebruikt worden om de kolom te visualiseren', () => {
        const field = fixture('vl-rich-data-field-content-template-fixture');
        field.valueTemplate().should.equal(field.querySelector('template[slot="content"]').innerHTML);
      });

      test('In de template content slot kan er gebruik gemaakt worden van de field data om de kolom te visualiseren', () => {
        const dataRow = {
          foo: {
            bar: 'foobar'
          }
        };
        const field = fixture('vl-rich-data-field-dynamic-content-template-fixture');
        field.valueTemplate(dataRow).trim('').should.equal('<span>foobar</span>');
      });

      test('Men kan de template van de label van een field opvragen voor een bepaalde rij data', () => {
        const field = fixture('vl-rich-data-field-fixture');
        field.labelTemplate().should.equal('Foo');
      });

      test('Indien er geen label attribuut aanwezig is, zal de template label slot gebruikt worden om de header te visualiseren', () => {
        const field = fixture('vl-rich-data-field-label-template-fixture');
        field.labelTemplate().should.equal(field.querySelector('template[slot="label"]').innerHTML);
      });

      test('Het aanpassen van de selector zorgt voor het afvuren van een event', (done) => {
        const field = fixture('vl-rich-data-field-fixture');

        field.addEventListener('change', event => {
          event.detail.properties.should.deep.equal(['selector']);
          field.selector.should.equal('bar');
          done();
        });

        field.dataset.vlSelector = 'bar';
      });

      test('Het aanpassen van de label zorgt voor het afvuren van een event', (done) => {
        const field = fixture('vl-rich-data-field-fixture');

        field.addEventListener('change', event => {
          event.detail.properties.should.deep.equal(['label']);
          field.label.should.equal('Bar');
          done();
        });

        field.dataset.vlLabel = 'Bar';
      });
    });
  </script>
</body>

</html>