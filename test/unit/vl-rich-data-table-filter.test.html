<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <script src="../../../@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../web-component-tester/browser.js"></script>

  <script type="module" src="../../src/vl-rich-data-table.js"></script>
</head>

<body>
  <test-fixture id="vl-rich-data-table-zonder-filter-fixture">
    <template>
      <vl-rich-data-table data-vl-data='[]'>
        <vl-rich-data-field id="id-field"></vl-rich-data-field>
        <vl-rich-data-field id="name-field"></vl-rich-data-field>
    </vl-rich-data-table>
    </template>
  </test-fixture>

  <test-fixture id="vl-rich-data-table-met-filter-fixture">
    <template>
      <vl-rich-data-table data-vl-data='[]' data-vl-filter-title='title'>
        <vl-rich-data-field id="id-field"></vl-rich-data-field>
        <vl-rich-data-field id="name-field"></vl-rich-data-field>
        <div slot="filter">
          <label>Hier kunnen filtervelden komen</label>
          <input type="text" name="filter1" />
        </div>
    </vl-rich-data-table>
    </template>
  </test-fixture>

  <script>
    suite('vl-rich-data-table met filter', () => {
      const should = chai.should();

      // test('Wanneer geen filterslot bestaat, zal er geen search filter aanwezig zijn', () => {
      //   const table = fixture('vl-rich-data-table-zonder-filter-fixture');
      //   should.not.exist(table.__searchFilter);
      // });

      // test('Wanneer wel een filterslot is bestaat, zal er een search filter aanwezig zijn', () => {
      //   const table = fixture('vl-rich-data-table-met-filter-fixture');
      //   should.exist(table.__searchFilter);
      // });

      // test('De inhoud van het filter-slot wordt gekopieerd in de searchfilter', (done) => {
      //   const table = fixture('vl-rich-data-table-met-filter-fixture');
      //   setTimeout(() => {
      //     const searchFilter = table.__searchFilter;

      //     expect(searchFilter.querySelector('label').textContent).to.equal('Hier kunnen filtervelden komen');
      //     expect(searchFilter.querySelector('input').getAttribute('name')).to.equal('filter1');
      //     done();
      //   });
      // });

      // test('De titel wordt correct getoond om een searchfilter', (done) => {
      //   const table = fixture('vl-rich-data-table-met-filter-fixture');
      //   setTimeout(() => {

      //     const searchFilter = table.__searchFilter;
      //     const searchFilterTitle = searchFilter.getAttribute('data-vl-title');
      //     searchFilterTitle.should.be.equal('title');
      //     done();
      //   });
      // });

      // test('Als er aan een input van de search filter iets wijzigt wordt er een event met formdata gestuurd', (done) => {
      //   const table = fixture('vl-rich-data-table-met-filter-fixture');
        
      //   setTimeout(() => {
      //     table.addEventListener('change', (e) => {
      //       expect(e.detail.formData.get('filter1')).to.equal('een beetje input');
      //       done();;
      //     });

      //     const searchFilter = table.__searchFilter;
      //     setInputValue(searchFilter.querySelector('input'), 'een beetje input');
      //   });
      // });

      // test('Als het filter-slot wijzigt wordt de nieuwe inhoud gekopieerd naar de searchfilter', (done) => {
      //   const table = fixture('vl-rich-data-table-met-filter-fixture');
      //   setTimeout(() => {
      //     modifyFilterSlot(table, '<input type="text" name="filter2" />');
      //     setTimeout(() => {

      //       const searchFilter = table.__searchFilter;
      //       expect(searchFilter.querySelector('input').getAttribute('name')).to.equal('filter2');
      //       done();
      //     });
      //   });
      // });


      function modifyFilterSlot(fixture, html) {

        const filterSlot = fixture.querySelector("[slot=filter]");
        filterSlot.innerHTML = html;
        debugger;
      }

      function setInputValue(input, value) {
        input.value = value;
        input.dispatchEvent(new CustomEvent('input', {detail: 'dummy-event', bubbles: true}));
      }

    });
</script>
</body>
</html>
