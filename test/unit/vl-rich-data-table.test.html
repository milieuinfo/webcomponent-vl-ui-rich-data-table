<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <script src="../../../@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../web-component-tester/browser.js"></script>

  <script type="module" src="../../src/vl-rich-data-table.js"></script>
  <script type="module" src="/node_modules/vl-ui-pager/dist/vl-pager.js"></script>
</head>

<body>
  <test-fixture id="vl-rich-data-table-fixture">
    <template>
      <vl-rich-data-table></vl-rich-data-table>
    </template>
  </test-fixture>

  <test-fixture id="vl-rich-data-table-fixture-responsive">
    <template>
      <vl-rich-data-table data-vl-collapsed-m data-vl-collapsed-s data-vl-collapsed-xs></vl-rich-data-table>
    </template>
  </test-fixture>

  <test-fixture id="vl-rich-data-table-pager-fixture">
    <template>
      <vl-rich-data-table>
        <vl-pager slot="pager" total-items="20" items-per-page="5" current-page="1"></vl-pager>
      </vl-rich-data-table>
    </template>
  </test-fixture>

  <script>
    suite('<vl-rich-data-table>', () => {
      const should = chai.should();

      test('De tabel wordt getoond in een grid met een kolom van breedte 12', () => {
        const richTable = fixture('vl-rich-data-table-fixture');
        const grid = richTable.shadowRoot.querySelector("div[is='vl-grid']");
        should.exist(grid);
        should.exist(grid.getAttribute("is-stacked"));
        const contentColumn = grid.querySelector("div#content[is='vl-column']");
        should.exist(contentColumn);
        assert.equal(contentColumn.getAttribute("size"), 12);
        const table = contentColumn.querySelector('table[is="vl-data-table"]');
        should.exist(table);
      });

      test('De tabel bevat een vl-data-table met de juiste subelementen', () => {
        const richTable = fixture('vl-rich-data-table-fixture');

        const table = richTable.shadowRoot.querySelector('[is="vl-data-table"]');
        should.exist(table);
        should.exist(table.querySelector('thead'));
        should.exist(table.querySelector('tbody'));
      });

      test('De responsive attributen op de rich-data-table worden doorgezet naar zijn interne data-table', () => {
        const richTable = fixture('vl-rich-data-table-fixture-responsive');
        const table = richTable.shadowRoot.querySelector('[is="vl-data-table"]');
        should.exist(table);
        assert.isTrue(table.hasAttribute("collapsed-m"));
        assert.isTrue(table.hasAttribute("collapsed-s"));
        assert.isTrue(table.hasAttribute("collapsed-xs"));
        richTable.removeAttribute("data-vl-collapsed-m");
        richTable.removeAttribute("data-vl-collapsed-s");
        richTable.removeAttribute("data-vl-collapsed-xs");
        assert.isFalse(table.hasAttribute("collapsed-m"));
        assert.isFalse(table.hasAttribute("collapsed-s"));
        assert.isFalse(table.hasAttribute("collapsed-xs"));
        richTable.setAttribute("data-vl-collapsed-m", "");
        richTable.setAttribute("data-vl-collapsed-s", "");
        richTable.setAttribute("data-vl-collapsed-xs", "");
        assert.isTrue(table.hasAttribute("collapsed-m"));
        assert.isTrue(table.hasAttribute("collapsed-s"));
        assert.isTrue(table.hasAttribute("collapsed-xs"));
      });

      test('De data op een tabel kan gezet worden via het data-vl-data attribuut', () => {
        const richTable = fixture('vl-rich-data-table-fixture');
        const value = {
          data: [{ foo: 'bar' }]
        };

        richTable.data.should.deep.equal({ data: [] });
        richTable.dataset.vlData = JSON.stringify(value);
        richTable.data.should.deep.equal(value);
      });

      test('De data op een tabel kan gezet worden via de data setter', () => {
        const richTable = fixture('vl-rich-data-table-fixture');
        const value = {
          data: [{ foo: 'bar' }]
        };

        richTable.data.should.deep.equal({ data: [] });
        richTable.data = value;
        richTable.data.should.deep.equal(value);
      });

      test('De paginatie van een tabel kan gezet worden via de data setter', () => {
        const richTable = fixture('vl-rich-data-table-pager-fixture');
        const value = { 
          data: [{ foo: 'bar' }],
          paging: {
            currentPage: 1,
            itemsPerPage: 2,
            totalItems: 3
          } 
        };

        richTable.data.should.deep.equal({ data: [] });
        richTable.data = value;
        richTable.data.should.deep.equal(value);
        const pager = richTable.querySelector('vl-pager');
        assert.equal(pager.currentPage, value.paging.currentPage);
        assert.equal(pager.itemsPerPage, value.paging.itemsPerPage);
        assert.equal(pager.totalItems, value.paging.totalItems);
      });

      test('De data op een tabel kan enkel doorgegeven worden als Array', (done) => {
        const richTable = fixture('vl-rich-data-table-fixture');

        richTable.data.should.deep.equal({ data: [] });
        try {
          richTable.data = {
            data: { foo: 'bar' }
          };
        } catch (error) {
          error.message.should.equal('vl-rich-data-table verwacht een Array als data');
          richTable.data.should.deep.equal({ data: [] });
          done();
        }
      });
    });
  </script>
</body>

</html>